# دليل مراقبة النظام - منصة سبق الذكية

## لوحة المراقبة الإدارية

### 1. سجلات النشاط (Activity Logs)
- **الوصول**: `/dashboard/activity-logs`
- **الصلاحية المطلوبة**: `system.view`
- **المميزات**:
  - عرض جميع الأنشطة في النظام
  - فلترة حسب نوع النشاط
  - معلومات IP والمستخدم
  - التوقيت الدقيق لكل نشاط

### 2. الأنشطة المراقبة
| النشاط | الوصف | مستوى الأهمية |
|---------|-------|---------------|
| login | تسجيل دخول ناجح | عادي |
| logout | تسجيل خروج | عادي |
| forgot_password | طلب إعادة تعيين كلمة المرور | متوسط |
| reset_password | تنفيذ إعادة تعيين كلمة المرور | عالي |
| update_profile | تحديث الملف الشخصي | متوسط |
| update_user | تحديث بيانات مستخدم | عالي |
| delete_user | حذف مستخدم | حرج |
| change_role | تغيير صلاحيات مستخدم | حرج |
| unauthorized_access | محاولة وصول غير مصرح | حرج |
| error | خطأ في النظام | عالي |

### 3. المؤشرات الرئيسية

#### أ. معدل النجاح/الفشل
```javascript
// محاولات تسجيل الدخول الفاشلة
const failedLogins = logs.filter(log => 
  log.action === 'login' && log.details?.reason
).length

// معدل النجاح
const successRate = (successfulLogins / totalLogins) * 100
```

#### ب. الأنشطة المشبوهة
- محاولات دخول متكررة فاشلة من نفس IP
- محاولات الوصول غير المصرح
- تغييرات متعددة في الصلاحيات
- حذف مستخدمين بشكل متكرر

### 4. التقارير الدورية

#### تقرير يومي
- عدد تسجيلات الدخول
- المستخدمون النشطون
- الأخطاء المسجلة
- محاولات الوصول المشبوهة

#### تقرير أسبوعي
- إحصائيات المستخدمين الجدد
- معدل استخدام النظام
- أكثر المستخدمين نشاطاً
- ملخص الأخطاء

#### تقرير شهري
- نمو المستخدمين
- تحليل الأداء
- توصيات الأمان
- خطط التحسين

### 5. التنبيهات التلقائية

#### التنبيهات الحرجة (فورية)
- 5 محاولات دخول فاشلة متتالية
- محاولة حذف أكثر من 3 مستخدمين
- تغيير صلاحيات المدير
- أخطاء في النظام

#### التنبيهات المتوسطة (خلال ساعة)
- إنشاء حساب مدير جديد
- تغييرات متعددة في الصلاحيات
- استخدام مرتفع للموارد

### 6. أفضل الممارسات

1. **المراجعة اليومية**: فحص سجلات النشاط يومياً
2. **التحليل الأسبوعي**: تحليل الأنماط والاتجاهات
3. **الأرشفة الشهرية**: حفظ السجلات القديمة
4. **التدقيق الربعي**: مراجعة شاملة للأمان

### 7. API للمراقبة الخارجية

```javascript
// جلب السجلات
GET /api/admin/activity-logs?limit=100&offset=0

// فلترة حسب النشاط
GET /api/admin/activity-logs?action=login&limit=50

// فلترة حسب المستخدم
GET /api/admin/activity-logs?userId=USER_ID

// Headers مطلوبة
Authorization: Bearer YOUR_TOKEN
```

### 8. التكامل مع أدوات المراقبة

#### Sentry (للأخطاء)
```javascript
Sentry.init({
  dsn: "YOUR_SENTRY_DSN",
  environment: process.env.NODE_ENV,
  integrations: [
    new Sentry.Integrations.Http({ tracing: true }),
  ],
})
```

#### LogRocket (لتجربة المستخدم)
```javascript
LogRocket.init('YOUR_APP_ID')
LogRocket.identify(userId, {
  name: userName,
  email: userEmail,
  role: userRole
})
```

#### Upstash (للتخزين المؤقت والإحصائيات)
```javascript
const redis = new Redis({
  url: process.env.UPSTASH_REDIS_URL,
  token: process.env.UPSTASH_REDIS_TOKEN,
})

// تتبع معدل الطلبات
await redis.incr(`rate_limit:${userId}`)
await redis.expire(`rate_limit:${userId}`, 3600)
```

### 9. لوحة تحكم مخصصة

يمكن إنشاء لوحة تحكم مخصصة تعرض:
- رسوم بيانية للأنشطة
- خريطة حرارية للاستخدام
- مؤشرات الأداء الحية
- تنبيهات في الوقت الفعلي

### 10. الصيانة الدورية

#### يومياً
- التحقق من الأخطاء
- مراجعة محاولات الدخول الفاشلة

#### أسبوعياً
- تنظيف السجلات القديمة
- تحديث التقارير

#### شهرياً
- أرشفة البيانات
- تحليل الأداء
- تحديث خطط الأمان

## الخلاصة

نظام المراقبة في منصة سبق الذكية يوفر رؤية شاملة لجميع الأنشطة، مما يساعد على:
- اكتشاف المشاكل مبكراً
- تحسين الأداء
- ضمان الأمان
- تحسين تجربة المستخدم 