# ๐ ูุธุงู ุงูุตูุงุญูุงุช ุงููุชูุฏู - ูุดุฑูุน ุณุจู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู ุตูุงุญูุงุช ูุชูุฏู ููุฑู ูุฏุนู:
- โ ุงูุฃุฏูุงุฑ ุงููุชุนุฏุฏุฉ (Roles)
- โ ุงูุตูุงุญูุงุช ุงูุชูุตูููุฉ (Permissions)
- โ ุฑุจุท ูุฑู ุจูู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
- โ ุญูุงูุฉ API Routes
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

## ๐๏ธ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ุฌุฏูู ุงูุฃุฏูุงุฑ (sabq_roles)
```sql
- id: UUID
- name: ุงุณู ุงูุฏูุฑ (admin, editor, user)
- nameAr: ุงูุงุณู ุจุงูุนุฑุจูุฉ
- description: ูุตู ุงูุฏูุฑ
- isActive: ุญุงูุฉ ุงูุฏูุฑ
```

### 2. ุฌุฏูู ุงูุตูุงุญูุงุช (sabq_permissions)
```sql
- id: UUID
- name: ุงุณู ุงูุตูุงุญูุฉ
- nameAr: ุงูุงุณู ุจุงูุนุฑุจูุฉ
- resource: ุงูููุฑุฏ (articles, users, comments, etc)
- action: ุงูุฅุฌุฑุงุก (create, read, update, delete, etc)
```

### 3. ุฌุฏูู ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช (sabq_role_permissions)
```sql
- id: UUID
- roleId: ูุนุฑู ุงูุฏูุฑ
- permissionId: ูุนุฑู ุงูุตูุงุญูุฉ
```

## ๐ฅ ุงูุฃุฏูุงุฑ ุงูุงูุชุฑุงุถูุฉ

### 1. ูุฏูุฑ (Admin)
- ุฌููุน ุงูุตูุงุญูุงุช
- ุฅุฏุงุฑุฉ ูุงููุฉ ูููุธุงู

### 2. ูุญุฑุฑ (Editor)
- ุฅุฏุงุฑุฉ ุงูููุงูุงุช
- ุฅุฏุงุฑุฉ ุงูุชุนูููุงุช
- ุงููุตูู ูููุญุฉ ุงูุชุญูู
- ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช

### 3. ูุณุชุฎุฏู (User)
- ูุฑุงุกุฉ ุงูููุงูุงุช
- ุฅุถุงูุฉ ุชุนูููุงุช
- ูุฑุงุกุฉ ุงูุชุนูููุงุช

## ๐ก๏ธ ููููุฉ ุงุณุชุฎุฏุงู ูุธุงู ุงูุตูุงุญูุงุช

### 1. ูู API Routes

```typescript
import { requirePermission } from '@/lib/auth/middleware'

export async function GET(request: NextRequest) {
  // ุงูุชุญูู ูู ุตูุงุญูุฉ ูุงุญุฏุฉ
  const authResult = await requirePermission(request, 'articles', 'read')
  if (authResult instanceof NextResponse) return authResult
  
  // ุจุงูู ุงูููุฏ...
}
```

### 2. ููุชุญูู ูู ุนุฏุฉ ุตูุงุญูุงุช

```typescript
import { requirePermissions } from '@/lib/auth/middleware'

const authResult = await requirePermissions(request, [
  { resource: 'articles', action: 'create' },
  { resource: 'articles', action: 'publish' }
])
```

### 3. ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

```typescript
// ุงูุชุญูู ูู ุงูุตูุงุญูุฉ
const hasPermission = user.permissions?.some(
  p => p.resource === 'articles' && p.action === 'create'
)

// ุนุฑุถ ุงูุนูุงุตุฑ ุญุณุจ ุงูุตูุงุญูุฉ
{hasPermission && (
  <button>ุฅูุดุงุก ููุงู ุฌุฏูุฏ</button>
)}
```

## ๐ ุญุณุงุจุงุช ุงูุงุฎุชุจุงุฑ

| ุงูุจุฑูุฏ ุงูุฅููุชุฑููู | ูููุฉ ุงููุฑูุฑ | ุงูุฏูุฑ | ุงูุตูุงุญูุงุช |
|-------------------|--------------|-------|-----------|
| admin@sabq.ai | Test@123456 | ูุฏูุฑ | ุฌููุน ุงูุตูุงุญูุงุช |
| editor@sabq.ai | Test@123456 | ูุญุฑุฑ | ุฅุฏุงุฑุฉ ุงููุญุชูู |
| user@sabq.ai | Test@123456 | ูุณุชุฎุฏู | ุงููุฑุงุกุฉ ูุงูุชุนููู |

## ๐ ุฅุถุงูุฉ ุตูุงุญูุงุช ุฌุฏูุฏุฉ

1. ุฃุถู ุงูุตูุงุญูุฉ ูู ููู `prisma/seed.ts`:
```typescript
{ 
  name: 'reports.view', 
  nameAr: 'ุนุฑุถ ุงูุชูุงุฑูุฑ', 
  resource: 'reports', 
  action: 'view' 
}
```

2. ุฃุนุฏ ุชุดุบูู ุงูุจุฐุฑ:
```bash
npm run prisma:seed
```

## ๐ ุฃูุงูุฑ ูููุฏุฉ

```bash
# ุชูููุฏ Prisma Client
npx prisma generate

# ุชุทุจูู ุงูุชุบููุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
npx prisma db push

# ุชุดุบูู ุงูุจุฐุฑ
npm run prisma:seed

# ูุชุญ Prisma Studio
npx prisma studio
```

## ๐ง ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

1. **ูุธุงู ุชุณุฌูู ุงูุฃูุดุทุฉ**: ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ
2. **ุตูุงุญูุงุช ุฏููุงููููุฉ**: ุฅููุงููุฉ ุฅุถุงูุฉ/ุชุนุฏูู ุงูุตูุงุญูุงุช ูู ููุญุฉ ุงูุชุญูู
3. **ุตูุงุญูุงุช ุนูู ูุณุชูู ุงูุณุฌู**: ุตูุงุญูุงุช ุฎุงุตุฉ ูุณุฌูุงุช ูุนููุฉ
4. **ูุฌููุนุงุช ุงููุณุชุฎุฏููู**: ุชุฌููุน ุงููุณุชุฎุฏููู ูู ูุฑู
5. **ุชูููุถ ุงูุตูุงุญูุงุช**: ุงูุณูุงุญ ูููุฏุฑุงุก ุจุชูููุถ ุตูุงุญูุงุชูู ูุคูุชุงู

---

ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ: ูุธุงู ุณุจู ุงูุฐูู
ุงูุชุงุฑูุฎ: ${new Date().toLocaleDateString('ar-SA')} 